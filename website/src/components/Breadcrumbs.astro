---
import { normalizeBase, buildHref } from "../utils/url";
import { getCollection } from "astro:content";

interface Props {
    currentPath: string;
}

const { currentPath } = Astro.props;
const base = normalizeBase(import.meta.env.BASE_URL);

// Get all docs to check which pages exist
const allDocs = await getCollection("docs");
const existingSlugs = new Set(allDocs.map(doc => doc.id));

const pathParts = currentPath.split("/").filter(Boolean);
const breadcrumbs = [
{ label: "Home", href: buildHref(base), exists: true },
...pathParts.map((part, index) => {
const slug = pathParts.slice(0, index + 1).join("/");
const href = buildHref(base, slug);
    const label = part
            .split("-")
            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
            .join(" ");
        // Check if this page exists in the docs collection
        const exists = existingSlugs.has(slug);
        return { label, href, exists };
    }),
];
---

<nav class="breadcrumbs" aria-label="Breadcrumb">
    <ol class="breadcrumb-list">
        {
            breadcrumbs.map((crumb, index) => (
                <li class="breadcrumb-item">
                    {index < breadcrumbs.length - 1 ? (
                    <>
                    {crumb.exists ? (
                    <a href={crumb.href} class="breadcrumb-link">
                            {crumb.label}
                        </a>
                    ) : (
                    <span class="breadcrumb-link breadcrumb-link--disabled">
                            {crumb.label}
                    </span>
                    )}
                        <span
                                class="breadcrumb-separator"
                            aria-hidden="true"
                    >
                            /
                            </span>
                        </>
                    ) : (
                        <span class="breadcrumb-current" aria-current="page">
                            {crumb.label}
                        </span>
                    )}
                </li>
            ))
        }
    </ol>
</nav>

<style>
    .breadcrumbs {
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }

    .breadcrumb-list {
        display: flex;
        flex-wrap: wrap;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 0.5rem;
        align-items: center;
    }

    .breadcrumb-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .breadcrumb-link {
        color: var(--text-secondary, #6a737d);
        text-decoration: none;
        transition: color 0.15s ease-out;
    }

    .breadcrumb-link:hover {
        color: var(--accent, #0066cc);
    }

    .breadcrumb-separator {
        color: var(--text-secondary, #6a737d);
        user-select: none;
    }

    .breadcrumb-current {
        color: var(--text-primary, #1a1a1a);
        font-weight: 500;
    }

    /* Dark mode styles (system preference) */
    @media (prefers-color-scheme: dark) {
        :root:not(.light-mode) .breadcrumb-link {
            color: var(--text-secondary);
        }

        :root:not(.light-mode) .breadcrumb-link:hover {
            color: var(--accent-light);
        }

        :root:not(.light-mode) .breadcrumb-separator {
            color: var(--text-secondary);
        }

        :root:not(.light-mode) .breadcrumb-current {
            color: var(--text-primary);
        }
    }

    /* Dark mode styles (manual toggle) */
    :root.dark-mode .breadcrumb-link {
        color: var(--text-secondary);
    }

    :root.dark-mode .breadcrumb-link:hover {
        color: var(--accent-light);
    }

    :root.dark-mode .breadcrumb-separator {
        color: var(--text-secondary);
    }

    :root.dark-mode .breadcrumb-current {
        color: var(--text-primary);
    }
</style>
