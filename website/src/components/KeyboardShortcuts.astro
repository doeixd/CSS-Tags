---
/**
 * KEYBOARD SHORTCUTS
 *
 * Global keyboard shortcuts for navigation and accessibility:
 * - Ctrl/Cmd + K: Focus search input
 * - Escape: Close mobile menu / blur search
 * - Alt + Arrow Left: Previous page
 * - Alt + Arrow Right: Next page
 * - ? (future): Show keyboard shortcuts help modal
 */
---

<script>
	let keydownHandler: ((e: KeyboardEvent) => void) | null = null;

	function setupKeyboardShortcuts() {
		// Clean up previous listener to prevent memory leaks
		if (keydownHandler) {
			document.removeEventListener('keydown', keydownHandler);
		}

		// Create new handler
		keydownHandler = (e: KeyboardEvent) => {
			// Ctrl/Cmd + K: Focus search
			if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
				e.preventDefault();
				const searchInput = document.querySelector('.pagefind-ui__search-input') as HTMLInputElement;
				if (searchInput) {
					searchInput.focus();
				}
			}

			// Escape: Close mobile menu and blur search
			if (e.key === 'Escape') {
				const sidebar = document.querySelector('.sidebar');
				const searchInput = document.querySelector('.pagefind-ui__search-input') as HTMLInputElement;

				if (sidebar?.classList.contains('open')) {
					sidebar.classList.remove('open');
				}

				if (searchInput && document.activeElement === searchInput) {
					searchInput.blur();
				}
			}

			// Arrow keys for prev/next navigation
			if (e.altKey) {
				if (e.key === 'ArrowLeft') {
					e.preventDefault();
					const prevLink = document.querySelector('.prev-link') as HTMLAnchorElement;
					if (prevLink) prevLink.click();
				}

				if (e.key === 'ArrowRight') {
					e.preventDefault();
					const nextLink = document.querySelector('.next-link') as HTMLAnchorElement;
					if (nextLink) nextLink.click();
				}
			}

			// ? key: Show keyboard shortcuts help
			// TODO: Implement help modal instead of console.log
			if (e.key === '?' && !e.ctrlKey && !e.metaKey) {
				const activeElement = document.activeElement as HTMLElement;
				if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
					// Future enhancement: Show keyboard shortcuts modal
					// For now, shortcuts are documented in component header comment
				}
			}
		};

		document.addEventListener('keydown', keydownHandler);
	}

	// Cleanup on page navigation
	document.addEventListener('astro:before-swap', () => {
		if (keydownHandler) {
			document.removeEventListener('keydown', keydownHandler);
			keydownHandler = null;
		}
	});

	document.addEventListener('DOMContentLoaded', setupKeyboardShortcuts);
	document.addEventListener('astro:after-swap', setupKeyboardShortcuts);
</script>
