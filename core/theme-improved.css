/**
 * Improved Theme System
 * ======================
 *
 * Merges the best of the original framework theme system with the theme generator.
 * Features OKLCH auto-contrast, comprehensive utilities, and simplified customization.
 */

@property --highlight-bg-subtle { syntax: '<color>'; }
@property --highlight-bg-overt { syntax: '<color>'; }

/* ============================================ */
/* LIGHT MODE THEME                            */
/* ============================================ */

:root {
  /* ============================================ */
  /* CUSTOMIZATION VARIABLES - Easy to modify   */
  /* ============================================ */

  /* Core Brand Color (OKLCH) */
  --accent-h: 280;           /* Hue (0-360°) */
  --accent-c: 0.15;          /* Chroma (0-1) */
  --accent-l: 60%;           /* Lightness (0-100%) */

  /* Theme Configuration */
  --surface-saturation: 0.015;  /* Surface chroma multiplier */
  --contrast-factor: 1.0;       /* Overall contrast multiplier */
  --border-width: 1px;          /* Default border width */
  --border-width-thick: 2px;    /* Thick border width */

  /* Border Radius Scale */
  --border-radius-sm: 3px;
  --border-radius-md: 6px;
  --border-radius-lg: 8px;
  --border-radius-xl: 12px;
  --border-radius-full: 9999px;

  /* Color Relationships */
  --secondary-hue-shift: 60;    /* Degrees for secondary (+60° = complementary) */
  --tertiary-hue-shift: -90;    /* Degrees for tertiary (-90° = triadic) */

  /* ============================================ */
  /* DERIVED COLORS - Auto-generated            */
  /* ============================================ */

  /* Secondary & Tertiary Hues */
  --secondary-h: calc((var(--accent-h) + var(--secondary-hue-shift)) mod 360);
  --tertiary-h: calc((var(--accent-h) + var(--tertiary-hue-shift)) mod 360);
  --neutral-h: var(--accent-h);

  /* Feedback Hues */
  --success-h: 145;  /* Green */
  --warning-h: 55;   /* Amber */
  --error-h: 25;     /* Red */
  --info-h: 245;     /* Blue */

   /* Base & Bedrock Colors */
   --base: oklch(97.5% calc(var(--surface-saturation) * 0.9) var(--neutral-h));
   --bedrock: oklch(8% calc(var(--surface-saturation) * 1.2) var(--neutral-h));

  /* Surface Hierarchy */
  --surface-muted: oklch(95% calc(var(--surface-saturation) * 0.8) var(--neutral-h));
  --surface-subtle: oklch(96% calc(var(--surface-saturation) * 1.05) var(--neutral-h));
  --surface: oklch(94% calc(var(--surface-saturation) * 1.2) var(--neutral-h));
  --surface-overt: oklch(77.5% calc(var(--surface-saturation) * 2.25) var(--neutral-h));

  /* ============================================ */
  /* TEXT COLORS - Auto-contrast calculation     */
  /* ============================================ */

  /* Base text colors */
  --text-muted: oklch(45% calc(var(--surface-saturation) * 1.5 * var(--contrast-factor)) var(--neutral-h));
  --text-subtle: oklch(35% calc(var(--surface-saturation) * 1.8 * var(--contrast-factor)) var(--neutral-h));
  --text: oklch(20% calc(var(--surface-saturation) * 2 * var(--contrast-factor)) var(--neutral-h));
  --text-overt: oklch(10% calc(var(--surface-saturation) * 2.2 * var(--contrast-factor)) var(--neutral-h));

   /* Auto-contrast text on surfaces (simplified for better browser support) */
   --text-on-base: oklch(15% 0.02 var(--neutral-h)); /* Dark text on light base */
   --text-on-bedrock: oklch(98% 0.01 var(--neutral-h)); /* Near-white text on dark bedrock */
   --text-on-surface-muted: oklch(20% 0.02 var(--neutral-h)); /* Dark text on light surface-muted */
   --text-on-surface-subtle: oklch(18% 0.02 var(--neutral-h)); /* Dark text on light surface-subtle */
   --text-on-surface: oklch(15% 0.02 var(--neutral-h)); /* Dark text on light surface */
   --text-on-surface-overt: oklch(12% 0.02 var(--neutral-h)); /* Dark text on light surface-overt */

  /* Link colors */
  --text-link: oklch(from var(--accent) calc(l + 0.1) calc(c + 0.05) h);
  --text-link-hover: oklch(from var(--text-link) calc(l - 0.1) c h);
  --text-link-visited: oklch(from var(--text-link) calc(l - 0.05) calc(c + 0.02) h);

  /* Highlighted text */
  --text-highlight-subtle: oklch(from var(--accent) calc(l + 0.2) calc(c - 0.05) h);
  --text-highlight-overt: oklch(from var(--accent) calc(l - 0.1) calc(c + 0.05) h);
  --text-highlight-bg: oklch(from var(--accent) calc(l + 0.8) calc(c - 0.3) h);

  /* ============================================ */
  /* OUTLINE & BORDER COLORS                     */
  /* ============================================ */

  /* General outlines */
  --outline-muted: oklch(from var(--base) calc(l - 0.04) calc(c + var(--surface-saturation) * 0.5) h);
  --outline-subtle: oklch(from var(--base) calc(l - 0.05) calc(c + var(--surface-saturation)) h);
  --outline: oklch(from var(--base) calc(l - 0.06) calc(c + var(--surface-saturation) * 1.5) h);
  --outline-overt: oklch(from var(--base) calc(l - 0.07) calc(c + var(--surface-saturation) * 2) h);

  /* Semantic outlines */
  --outline-focus: oklch(from var(--accent) calc(l - 0.1) calc(c + 0.1) h);
  --outline-active: oklch(from var(--accent) calc(l - 0.05) calc(c + 0.05) h);
  --outline-error: oklch(50% 0.2 var(--error-h));
  --outline-warning: oklch(65% 0.15 var(--warning-h));
  --outline-success: oklch(55% 0.15 var(--success-h));
  --outline-info: oklch(60% 0.15 var(--info-h));

  /* ============================================ */
  /* HIGHLIGHT & INTERACTION COLORS              */
  /* ============================================ */

  /* Selection and hover backgrounds */
  --highlight-muted: oklch(from var(--base) calc(l - 0.01) c h);
  --highlight-subtle: oklch(from var(--base) calc(l - 0.03) c h);
  --highlight-overt: oklch(from var(--accent) calc(l + 0.8) calc(c - 0.3) h);

  /* Scrim */
  --scrim: oklch(0% 0 0 / 0.5);
  --scrim-light: oklch(100% 0 0 / 0.3);

  /* ============================================ */
  /* ACCENT COLOR SYSTEM                         */
  /* ============================================ */

  /* Primary accent variations */
  --accent: oklch(var(--accent-l) var(--accent-c) var(--accent-h));
  --accent-muted: oklch(from var(--accent) calc(l + 0.15) calc(c - 0.05) h);
  --accent-subtle: oklch(from var(--accent) calc(l + 0.05) calc(c - 0.02) h);
  --accent-surface: oklch(from var(--accent) calc(l + 0.8) calc(c - 0.1) h);
  --accent-overt: oklch(from var(--accent) calc(l - 0.1) calc(c + 0.05) h);
  --accent-highlight: oklch(from var(--accent) calc(l + 0.5) calc(c - 0.2) h);

   /* Accent text on different surfaces (simplified) */
   --accent-on-base: oklch(15% 0.02 var(--neutral-h)); /* Dark text on light base */
   --accent-on-bedrock: oklch(98% 0.01 var(--neutral-h)); /* Near-white text on dark bedrock */
   --accent-on-surface: oklch(15% 0.02 var(--neutral-h)); /* Dark text on light surface */

  /* ============================================ */
  /* SECONDARY & TERTIARY SYSTEMS                */
  /* ============================================ */

  /* Secondary colors */
  --secondary: oklch(var(--accent-l) var(--accent-c) var(--secondary-h));
  --secondary-muted: oklch(from var(--secondary) calc(l + 0.15) calc(c - 0.05) h);
  --secondary-subtle: oklch(from var(--secondary) calc(l + 0.05) calc(c - 0.02) h);
  --secondary-overt: oklch(from var(--secondary) calc(l - 0.1) calc(c + 0.05) h);

  /* Tertiary colors */
  --tertiary: oklch(var(--accent-l) var(--accent-c) var(--tertiary-h));
  --tertiary-muted: oklch(from var(--tertiary) calc(l + 0.15) calc(c - 0.05) h);
  --tertiary-subtle: oklch(from var(--tertiary) calc(l + 0.05) calc(c - 0.02) h);
  --tertiary-overt: oklch(from var(--tertiary) calc(l - 0.1) calc(c + 0.05) h);

  /* ============================================ */
  /* SEMANTIC COLORS (Success, Warning, etc.)    */
  /* ============================================ */

  --success: oklch(55% 0.15 var(--success-h));
  --warning: oklch(70% 0.15 var(--warning-h));
  --error: oklch(60% 0.2 var(--error-h));
  --info: oklch(65% 0.15 var(--info-h));

  /* Semantic text colors */
  --text-success: var(--success);
  --text-warning: var(--warning);
  --text-error: var(--error);
  --text-info: var(--info);

  /* Semantic surface colors */
  --surface-success: oklch(from var(--success) calc(l + 0.9) calc(c - 0.1) h);
  --surface-warning: oklch(from var(--warning) calc(l + 0.8) calc(c - 0.1) h);
  --surface-error: oklch(from var(--error) calc(l + 0.8) calc(c - 0.1) h);
  --surface-info: oklch(from var(--info) calc(l + 0.8) calc(c - 0.1) h);

  /* ============================================ */
  /* LEGACY FRAMEWORK COMPATIBILITY              */
  /* ============================================ */

  /* Map to original framework variables for compatibility */
  --theme-primary: var(--accent);
  --theme-secondary: var(--secondary);
  --theme-surface: var(--surface);
  --theme-surface-subtle: var(--surface-subtle);
  --theme-text: var(--text);
  --theme-text-muted: var(--text-muted);
  --theme-outline: var(--outline);
  --theme-outline-focus: var(--outline-focus);
  --theme-success: var(--success);
  --theme-warning: var(--warning);
  --theme-error: var(--error);
  --theme-info: var(--info);

  /* Enhanced focus state variables */
  --focus-ring-width: 2px;
  --focus-ring-offset: 2px;
  --focus-ring-color: var(--outline-focus);
  --focus-ring-style: solid;

  /* Form element specific focus states */
  --input-focus-ring-width: var(--focus-ring-width);
  --input-focus-ring-offset: 0px;
  --input-focus-bg: transparent;
  --input-hover-border-color: var(--outline-overt);

  /* Enhanced link styling variables */
  --link-decoration: none;
  --link-decoration-hover: underline;
  --link-underline-thickness: 1.5px;
  --link-underline-offset: 0.15em;
  --link-transition-duration: 150ms;
  --link-transition-timing: ease-out;

  /* Container query configuration */
  --cq-type: inline-size;
  --cq-name: default;

  /* Typography (from tokens) */
  --font-family: system-ui, -apple-system, sans-serif;
  --font-size-base: 1rem;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --line-height-base: 1.5;
}

/* ============================================ */
/* DARK MODE THEME                             */
/* ============================================ */

@media (prefers-color-scheme: dark) {
  :root {
   /* Dark mode adjustments */
   :root {
     /* Dark mode adjustments */
     --accent-l: 70%;
     --accent-c: 0.18;
     --surface-saturation: 0.02;

     /* Invert surface hierarchy for dark backgrounds */
     --base: oklch(22% calc(var(--surface-saturation) * 0.9) var(--neutral-h));
     --bedrock: oklch(98% calc(var(--surface-saturation) * 0.7) var(--neutral-h));

     --surface-muted: oklch(20% calc(var(--surface-saturation) * 0.5) var(--neutral-h));
     --surface-subtle: oklch(21% calc(var(--surface-saturation) * 0.7) var(--neutral-h));
     --surface: oklch(25% var(--surface-saturation) var(--neutral-h));
     --surface-overt: oklch(30% calc(var(--surface-saturation) * 1.2) var(--neutral-h));

     /* Adjust text for dark backgrounds */
     --text-muted: oklch(65% calc(var(--surface-saturation) * 1.2) var(--neutral-h));
     --text-subtle: oklch(75% calc(var(--surface-saturation) * 1.0) var(--neutral-h));
     --text: oklch(88% calc(var(--surface-saturation) * 0.8) var(--neutral-h));
     --text-overt: oklch(95% calc(var(--surface-saturation) * 0.6) var(--neutral-h));

     /* Auto-contrast text on surfaces for dark mode */
     --text-on-base: oklch(90% 0.02 var(--neutral-h)); /* Light text on dark base */
     --text-on-bedrock: oklch(5% 0.01 var(--neutral-h)); /* Near-black text on light bedrock */
     --text-on-surface-muted: oklch(85% 0.02 var(--neutral-h)); /* Light text on dark surface-muted */
     --text-on-surface-subtle: oklch(87% 0.02 var(--neutral-h)); /* Light text on dark surface-subtle */
     --text-on-surface: oklch(90% 0.02 var(--neutral-h)); /* Light text on dark surface */
     --text-on-surface-overt: oklch(92% 0.02 var(--neutral-h)); /* Light text on dark surface-overt */

     /* Accent text on surfaces for dark mode */
     --accent-on-base: oklch(90% 0.02 var(--neutral-h)); /* Light text on dark base */
     --accent-on-bedrock: oklch(5% 0.01 var(--neutral-h)); /* Near-black text on light bedrock */
     --accent-on-surface: oklch(90% 0.02 var(--neutral-h)); /* Light text on dark surface */
   }
}

/* ============================================ */
/* HIGH CONTRAST MODE                          */
/* ============================================ */

@media (prefers-contrast: high) {
  :root {
    --contrast-factor: 1.3;
    --border-width: 2px;
    --border-width-thick: 3px;

    /* Enhanced contrasts */
    --text-subtle: oklch(30% 0.03 var(--neutral-h));
    --text-muted: oklch(25% 0.02 var(--neutral-h));
    --outline-focus: oklch(50% 0.3 var(--accent-h));
    --outline: oklch(from var(--base) calc(l - 0.08) calc(c + var(--surface-saturation) * 2) h);
  }

  /* High contrast form elements */
  input, select, textarea, button {
    border-width: var(--border-width-thick) !important;
  }
}

/* ============================================ */
/* BRAND THEME OVERRIDES                       */
/* ============================================ */

:root[data-theme="ocean"] {
  --accent-h: 200; --accent-c: 0.16; --accent-l: 60%;
  --secondary-hue-shift: 40; --tertiary-hue-shift: -80;
}

:root[data-theme="sunrise"] {
  --accent-h: 30; --accent-c: 0.18; --accent-l: 62%;
  --secondary-hue-shift: 60; --tertiary-hue-shift: -90;
}

:root[data-theme="forest"] {
  --accent-h: 145; --accent-c: 0.16; --accent-l: 58%;
  --secondary-hue-shift: 50; --tertiary-hue-shift: -100;
}

/* Dark mode brand adjustments */
@media (prefers-color-scheme: dark) {
  :root[data-theme="ocean"] {
    --accent-c: 0.20; --accent-l: 70%;
  }
  :root[data-theme="sunrise"] {
    --accent-c: 0.22; --accent-l: 72%;
  }
  :root[data-theme="forest"] {
    --accent-c: 0.18; --accent-l: 68%;
  }
}

/* ============================================ */
/* AUTO-CONTEXT STYLING                         */
/* ============================================ */

/* Automatic text color based on surface */
.bg-base .text,
.bg-base .text-muted,
.bg-base .text-subtle,
.bg-base .text-overt,
.bg-base .text-link,
.bg-base p,
.bg-base span,
.bg-base h1,
.bg-base h2,
.bg-base h3,
.bg-base h4,
.bg-base h5,
.bg-base h6,
.bg-base strong,
.bg-base em,
.bg-base a { color: var(--text-on-base) !important; }

.bg-bedrock .text,
.bg-bedrock .text-muted,
.bg-bedrock .text-subtle,
.bg-bedrock .text-overt,
.bg-bedrock .text-link,
.bg-bedrock p,
.bg-bedrock span,
.bg-bedrock h1,
.bg-bedrock h2,
.bg-bedrock h3,
.bg-bedrock h4,
.bg-bedrock h5,
.bg-bedrock h6,
.bg-bedrock strong,
.bg-bedrock em,
.bg-bedrock a { color: var(--text-on-bedrock) !important; }

.bg-surface .text,
.bg-surface .text-muted,
.bg-surface .text-subtle,
.bg-surface .text-overt,
.bg-surface .text-link,
.bg-surface p,
.bg-surface span,
.bg-surface h1,
.bg-surface h2,
.bg-surface h3,
.bg-surface h4,
.bg-surface h5,
.bg-surface h6,
.bg-surface strong,
.bg-surface em,
.bg-surface a { color: var(--text-on-surface) !important; }

.bg-surface-muted .text,
.bg-surface-muted .text-muted,
.bg-surface-muted .text-subtle,
.bg-surface-muted .text-overt,
.bg-surface-muted .text-link,
.bg-surface-muted p,
.bg-surface-muted span,
.bg-surface-muted h1,
.bg-surface-muted h2,
.bg-surface-muted h3,
.bg-surface-muted h4,
.bg-surface-muted h5,
.bg-surface-muted h6,
.bg-surface-muted strong,
.bg-surface-muted em,
.bg-surface-muted a { color: var(--text-on-surface-muted) !important; }

.bg-surface-subtle .text,
.bg-surface-subtle .text-muted,
.bg-surface-subtle .text-subtle,
.bg-surface-subtle .text-overt,
.bg-surface-subtle .text-link,
.bg-surface-subtle p,
.bg-surface-subtle span,
.bg-surface-subtle h1,
.bg-surface-subtle h2,
.bg-surface-subtle h3,
.bg-surface-subtle h4,
.bg-surface-subtle h5,
.bg-surface-subtle h6,
.bg-surface-subtle strong,
.bg-surface-subtle em,
.bg-surface-subtle a { color: var(--text-on-surface-subtle) !important; }

.bg-surface-overt .text,
.bg-surface-overt .text-muted,
.bg-surface-overt .text-subtle,
.bg-surface-overt .text-overt,
.bg-surface-overt .text-link,
.bg-surface-overt p,
.bg-surface-overt span,
.bg-surface-overt h1,
.bg-surface-overt h2,
.bg-surface-overt h3,
.bg-surface-overt h4,
.bg-surface-overt h5,
.bg-surface-overt h6,
.bg-surface-overt strong,
.bg-surface-overt em,
.bg-surface-overt a { color: var(--text-on-surface-overt) !important; }

/* Automatic accent text on surfaces */
.bg-accent .text-accent { color: var(--accent-on-base); }
.bg-surface .text-accent { color: var(--accent-on-surface); }

/* Automatic button styling based on context */
.bg-base .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-bedrock .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-surface .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-surface-muted .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-surface-subtle .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-surface-overt .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-accent .button {
  background-color: var(--surface);
  color: var(--text-on-surface);
}
.bg-accent .button-primary {
  background-color: var(--accent);
  color: var(--accent-on-base);
}

.bg-accent .button-primary {
  background-color: var(--accent);
  color: var(--accent-on-base);
}